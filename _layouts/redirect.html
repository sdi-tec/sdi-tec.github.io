---
layout: default
---

<div class="redirect-container">
    <div class="spinner"></div>
    <div class="redirect-text">Redirigiendo...</div>
    <div class="manual-link">
        <a href="#" id="manual-link">Clic aquí si no se redirige automáticamente</a>
    </div>
</div>

<script>
    (function() {
        // Parse URL parameters
        const urlParams = new URLSearchParams(window.location.search);
        
        // Get redirect parameters
        const targetUrl = urlParams.get('url') || urlParams.get('redirect');
        const documentName = urlParams.get('doc') || urlParams.get('document');
        const pageNumber = urlParams.get('page') || urlParams.get('p');
        const timestamp = urlParams.get('ts') || urlParams.get('timestamp');
        const campaign = urlParams.get('utm_campaign');
        const source = urlParams.get('utm_source') || 'pdf';
        const medium = urlParams.get('utm_medium') || 'document';
        
        // Validate target URL
        if (!targetUrl) {
            document.getElementById('manual-link').style.display = 'none';
            document.querySelector('.redirect-text').textContent = 'Error: URL de destino no especificada';
            return;
        }
        
        // Validate URL format
        let finalUrl;
        try {
            // If it's a relative URL, make it absolute
            if (targetUrl.startsWith('/') || targetUrl.startsWith('./')) {
                finalUrl = window.location.origin + targetUrl;
            } else if (targetUrl.startsWith('http://') || targetUrl.startsWith('https://')) {
                finalUrl = targetUrl;
            } else if (targetUrl.startsWith('mailto:') || targetUrl.startsWith('tel:') || targetUrl.startsWith('whatsapp:')) {
                finalUrl = targetUrl;
            } else {
                // Assume it's a relative path
                finalUrl = window.location.origin + '/' + targetUrl;
            }
        } catch (e) {
            document.getElementById('manual-link').style.display = 'none';
            document.querySelector('.redirect-text').textContent = 'Error: URL inválida';
            return;
        }
        
        // Update display
        document.querySelector('.redirect-text').textContent = `Redirigiendo a: ${finalUrl}`;
        document.getElementById('manual-link').href = finalUrl;
        
        // Track with GoatCounter - campaigns are tracked automatically from URL parameters
        // Just need to ensure the page loads with the UTM parameters for GoatCounter to detect them
        
        // Redirect after a short delay to allow GoatCounter to track
        setTimeout(() => {
            window.location.href = finalUrl;
        }, 1500);
    })();
</script>
